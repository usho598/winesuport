<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>受注登録 | ワイサポ販売管理システム</title>
    <meta data-page-title="受注登録" content="受注登録">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css">
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/layout.js"></script>
    
</head>
<body class="bg-gray-100">
    <div class="flex h-screen">
        <div class="side-nav">
            <div class="side-nav-logo">
                <a href="../index.html" class="text-white">ワイサポ</a>
            </div>
            <div class="side-nav-content">
                <nav class="mt-4">
                    <a href="index.html" class="side-nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                        受注管理
                    </a>
                    <a href="customer-list.html" class="side-nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        顧客管理
                    </a>
                    <a href="inventory.html" class="side-nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                        </svg>
                        在庫管理
                    </a>
                    <a href="activity-list.html" class="side-nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        活動管理
                    </a>
                    <a href="discount-rules.html" class="side-nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                        </svg>
                        取引調整
                    </a>
                    <a href="invoice-list.html" class="side-nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        請求回収管理
                    </a>
                    <a href="delivery-status.html" class="side-nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        納品状況確認
                    </a>
                    <a href="dashboard.html" class="side-nav-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        ダッシュボード
                    </a>
                </nav>
            </div>
            <div class="side-nav-footer">
                <div class="text-xs">
                    <div>ユーザー：<span class="font-medium">田中太郎</span></div>
                    <div>ワイサポ販売管理システム v1.0</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <header class="header">
                <div class="flex items-center">
                    <button class="mobile-nav-button mr-4 lg:hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <div class="header-title">受注登録</div>
                     <span class="ml-3 px-2 bg-red-100 text-red-800 text-xs rounded-full">社内管理画面</span>
                </div>
                <div class="header-actions">
                    <span class="mr-4 hidden md:inline-block">田中太郎</span>
                    <button class="notification-badge bg-gray-200 rounded-full p-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                        <span class="notification-indicator">3</span>
                    </button>
                </div>
            </header>

            <main class="content">
                <div class="bg-white rounded shadow p-6">
                    <form x-data="{
                        selectedCustomer: '',
                        selectedDeliveryLocation: '',
                        deliveryType: '',
                        lineItems: [
                        { product: '', productName: '', quantity: 1, price: 0, stockAvailable: 100, isNormalSale: false }
                        ],
                        addLineItem() {
                        this.lineItems.push({ product: '', productName: '', quantity: 1, price: 0, stockAvailable: 100, isNormalSale: false });
                        },
                        removeLineItem(index) {
                        this.lineItems.splice(index, 1);
                        },
                        updateDeliveryType() {
                        // 納品先が「配置」かどうかをシミュレート
                        this.deliveryType = this.selectedDeliveryLocation === '大阪本社' ? '配置' : '通常';
                        }
                    }">
                        <div class="border-b pb-6 mb-6">
                            <h2 class="text-lg font-medium mb-4">基本情報</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-2">顧客 <span class="text-red-600">*</span></label>
                                    <div class="relative">
                                        <select x-model="selectedCustomer" class="w-full border rounded px-3 py-2 appearance-none bg-white" required>
                                            <option value="">顧客を選択してください</option>
                                            <option value="1">株式会社山田商事</option>
                                            <option value="2">有限会社佐藤工業</option>
                                            <option value="3">株式会社中村電機</option>
                                        </select>
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                            </svg>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm text-gray-600 mb-2">納品先 <span class="text-red-600">*</span></label>
                                    <div class="relative">
                                        <select x-model="selectedDeliveryLocation" @change="updateDeliveryType" class="w-full border rounded px-3 py-2 appearance-none bg-white" required>
                                            <option value="">納品先を選択してください</option>
                                            <option value="東京本社">東京本社</option>
                                            <option value="大阪本社">大阪本社 (配置)</option>
                                            <option value="レストラン「フレンチ山田」">レストラン「フレンチ山田」</option>
                                            <option value="福岡支店">福岡支店</option>
                                        </select>
                                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                            </svg>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm text-gray-600 mb-2">受注日 <span class="text-red-600">*</span></label>
                                    <input type="date" class="w-full border rounded px-3 py-2" required>
                                </div>

                                <div>
                                    <label class="block text-sm text-gray-600 mb-2">納期</label>
                                    <input type="date" class="w-full border rounded px-3 py-2">
                                </div>

                                <div>
                                    <label class="block text-sm text-gray-600 mb-2">販売区分</label>
                                    <div class="flex items-center mt-2">
                                        <span x-text="deliveryType ? deliveryType : '未選択'" class="px-3 py-1 bg-gray-100 rounded text-gray-800"></span>
                                        <span class="ml-2 text-sm text-gray-500">（納品先の選択により自動設定されます）</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-lg font-medium">商品情報</h2>
                                <button type="button" @click="addLineItem" class="bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                ＋ 商品追加
                                </button>
                            </div>

                            <div class="grid grid-cols-12 gap-2 py-2 font-medium text-sm bg-gray-50 px-3 rounded-t border-b">
                                <div class="col-span-4">商品</div>
                                <div class="col-span-2">数量</div>
                                <div class="col-span-2">在庫数</div>
                                <div class="col-span-2">単価</div>
                                <div class="col-span-1" x-show="deliveryType === '配置'">通常売上</div>
                                <div class="col-span-1"></div>
                            </div>

                            <template x-for="(item, index) in lineItems" :key="index">
                                <div class="grid grid-cols-12 gap-2 py-3 border-b items-center px-3">
                                <div class="col-span-4">
                                    <div class="relative">
                                    <select x-model="item.product" class="w-full border rounded px-3 py-2 appearance-none bg-white">
                                        <option value="">商品を選択</option>
                                        <option value="P001">シャトー・マルゴー 2018</option>
                                        <option value="P002">バローロ・リゼルヴァ 2017</option>
                                        <option value="P003">シャブリ グランクリュ 2019</option>
                                        <option value="P004">ドン・ペリニヨン 2012</option>
                                        <option value="P005">ソーヴィニヨン・ブラン 2021</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                                        </svg>
                                    </div>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <input type="number" x-model="item.quantity" min="1" class="w-full border rounded px-3 py-2">
                                </div>
                                <div class="col-span-2">
                                    <div class="flex items-center">
                                    <span x-text="item.stockAvailable" class="text-sm"></span>
                                    <span class="text-sm text-gray-500 ml-1">本</span>
                                    </div>
                                </div>
                                <div class="col-span-2">
                                    <input type="number" x-model="item.price" min="0" class="w-full border rounded px-3 py-2">
                                </div>
                                <div class="col-span-1" x-show="deliveryType === '配置'">
                                    <input type="checkbox" x-model="item.isNormalSale" class="h-5 w-5 text-blue-600 rounded">
                                </div>
                                <div class="col-span-1">
                                    <button type="button" @click="removeLineItem(index)" class="text-red-600 hover:text-red-800">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                    </button>
                                </div>
                                </div>
                            </template>

                            <div class="flex justify-end mt-4">
                                <div class="w-64">
                                <div class="flex justify-between py-2">
                                    <span>小計:</span>
                                    <span>¥0</span>
                                </div>
                                <div class="flex justify-between py-2">
                                    <span>消費税:</span>
                                    <span>¥0</span>
                                </div>
                                <div class="flex justify-between py-2 font-bold">
                                    <span>合計:</span>
                                    <span>¥0</span>
                                </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-sm text-gray-600 mb-2">備考</label>
                            <textarea class="w-full border rounded px-3 py-2 h-24"></textarea>
                        </div>

                        <div class="mt-8 flex justify-end space-x-4">
                            <a href="../index.html" class="px-6 py-2 border border-gray-300 rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50">
                                キャンセル
                            </a>
                            <button type="button" class="px-6 py-2 border border-blue-300 rounded shadow-sm text-blue-700 bg-white hover:bg-blue-50">
                                下書き保存
                            </button>
                            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded shadow-sm hover:bg-blue-700">
                                受注確定
                            </button>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.side-nav-item');
            const currentPage = window.location.pathname.split('/').pop();
            navLinks.forEach(link => {
                const href = link.getAttribute('href');
                // href は 'index.html' のような形式なので、ファイル名のみを抽出
                const linkPage = href.split('/').pop();
                if (linkPage === currentPage) {
                    link.classList.add('active');
                    link.classList.add('bg-red-900');
                }
            });
        });
    </script>
</body>
</html>